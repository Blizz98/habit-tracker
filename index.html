<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Be Productive!</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <div class="header">
      <h1>Be Productive!</h1>
      <div class="date">{{ currentDate }}</div>
    </div>

    <!-- Calendar Carousel -->
    <div class="calendar-carousel" ref="carouselRef">
      <div 
        v-for="day in carouselDays" 
        :key="day.date" 
        class="carousel-day" 
        :class="{
          today: day.isToday,
          complete: day.completionRate === 1,
          partial: day.completionRate > 0 && day.completionRate < 1,
          incomplete: day.completionRate === 0 && !day.isToday && day.hasHabits
        }"
      >
        <div class="weekday">{{ day.weekday }}</div>
        <div class="day">{{ day.day }}</div>
      </div>
    </div>

    <!-- Category Filter -->
    <div class="category-filter" v-if="habits.length > 0">
      <button 
        class="filter-btn" 
        :class="{ active: selectedCategory === null }"
        @click="selectedCategory = null"
      >
        V≈°e
      </button>
      <button 
        v-for="category in categories" 
        :key="category.id"
        class="filter-btn"
        :class="{ active: selectedCategory === category.id }"
        :style="{ '--category-color': category.color }"
        @click="selectedCategory = category.id"
      >
        <span class="filter-dot" :style="{ background: category.color }"></span>
        {{ category.name }}
      </button>
    </div>

    <!-- Statistics Cards -->
    <div class="stats">
      <div class="stat-card">
        <span class="number">{{ todayCompleted }}/{{ todayTotal }}</span>
        <span class="label">Dnes</span>
      </div>
      <div class="stat-card">
        <span class="number">{{ totalHabits }}</span>
        <span class="label">Zvyk≈Ø</span>
      </div>
      <div class="stat-card">
        <span class="number">{{ bestStreak }}</span>
        <span class="label">Top S√©rie</span>
      </div>
    </div>

    <!-- Habits List -->
    <div class="habits" v-if="filteredHabits.length > 0">
      <div 
        class="habit" 
        v-for="(habit, index) in filteredHabits" 
        :key="habit.id" 
        :class="{ 
          'habit-inactive': !isHabitActiveToday(habit),
          'habit-completed': isHabitActiveToday(habit) && isFullyDoneToday(habit),
          'habit-celebrating': celebratingHabitId === habit.id,
          'dragging': draggedHabit && draggedHabit.id === habit.id
        }"
        @dragover.prevent="onDragOver($event, index)"
      >
        <!-- Category Indicator -->
        <div 
          class="habit-category-indicator" 
          v-if="habit.categoryId"
          :style="{ background: getCategoryColor(habit.categoryId) }"
        ></div>

        <!-- Completed Overlay
        <div class="habit-completed-overlay" v-if="isHabitActiveToday(habit) && isFullyDoneToday(habit)">
          <span class="completed-badge">‚úì</span>
        </div> -->

        <!-- Celebration Particles -->
        <div class="celebration-particles" v-if="celebratingHabitId === habit.id">
          <span class="particle">‚ú®</span>
          <span class="particle">‚≠ê</span>
          <span class="particle">üéâ</span>
          <span class="particle">‚ú®</span>
          <span class="particle">‚≠ê</span>
          <span class="particle">üí´</span>
          <span class="particle">üåü</span>
          <span class="particle">üéä</span>
        </div>

        <!-- Drag Handle - ONLY this triggers drag -->
        <div 
          class="habit-drag-handle"
          draggable="true"
          @dragstart="onDragStart($event, index)"
          @dragend="onDragEnd"
          @touchstart.prevent="onTouchStart($event, index)"
          @touchmove.prevent="onTouchMove($event)"
          @touchend="onTouchEnd"
        >
          <span>‚ãÆ‚ãÆ</span>
        </div>

        <!-- Habit Icon -->
        <div class="habit-icon">{{ habit.icon }}</div>

        <!-- Habit Info -->
        <div class="habit-info">
          <h3>{{ habit.name }}</h3>
          <div class="progress-info" v-if="habit.dailyGoal > 1 && isHabitActiveToday(habit)">
            <span class="progress-count">{{ getCompletionCount(habit) }}/{{ habit.dailyGoal }}</span>
            <div class="progress-bar-container">
              <div class="progress-bar" :style="{ width: getProgressPercent(habit) + '%' }"></div>
            </div>
          </div>
          <div class="streak" v-if="isHabitActiveToday(habit)">
            <span class="fire">üî•</span> {{ streak(habit) }} denn√≠ s√©rie
          </div>
          <div class="habit-days-indicator" v-if="!isHabitActiveToday(habit)">
            Dnes volno ‚Ä¢ {{ getActiveDaysText(habit) }}
          </div>
          <div class="habit-days-indicator" v-else-if="habit.activeDays && habit.activeDays.length < 7">
            {{ getActiveDaysText(habit) }}
          </div>
        </div>

        <!-- Actions Container -->
        <div class="habit-actions">
          <!-- Habit Check Button -->
          <div 
            class="habit-check" 
            :class="{ 
              partial: getCompletionCount(habit) > 0 && getCompletionCount(habit) < habit.dailyGoal,
              done: isFullyDoneToday(habit) 
            }"
            :style="{ '--progress': getProgressPercent(habit) }"
            @click="toggleToday(habit)"
            v-if="isHabitActiveToday(habit)"
          >
            <span class="checkmark">‚úì</span>
          </div>
          <div class="habit-check" v-else style="opacity: 0.3; pointer-events: none;">
            <span class="checkmark">‚Äî</span>
          </div>

          <!-- Action Buttons (Edit & Delete) -->
          <div class="habit-action-buttons">
            <button class="habit-edit" @click="openEditModal(habit)">‚úé</button>
            <button class="habit-delete" @click="removeHabit(habit)">√ó</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" v-else-if="habits.length === 0">
      <span class="emoji">üéØ</span>
      <h3>≈Ω√°dn√© zvyky</h3>
      <p>P≈ôidej sv≈Øj prvn√≠ zvyk a zaƒçni!</p>
    </div>

    <!-- Empty Filter State -->
    <div class="empty-state" v-else>
      <span class="emoji">üîç</span>
      <h3>≈Ω√°dn√© zvyky v t√©to kategorii</h3>
      <p>Vyber jinou kategorii nebo p≈ôidej nov√Ω zvyk</p>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <div class="nav-container">
        <button class="nav-btn" @click="showCalendar = true">
          <span>üìÖ</span>
        </button>
        <button class="nav-btn nav-btn-add" @click="showModal = true">
          <span>+</span>
        </button>
        <button class="nav-btn" @click="showSettings = true">
          <span>üìä</span>
        </button>
      </div>
    </div>

    <!-- Toast Notification -->
    <transition name="toast">
      <div class="toast" v-if="toast.show" :class="toast.type">
        <span class="toast-icon">{{ toast.icon }}</span>
        <span class="toast-message">{{ toast.message }}</span>
      </div>
    </transition>

    <!-- Calendar View Modal -->
    <div class="calendar-view" v-if="showCalendar" @click.self="showCalendar = false">
      <div class="calendar-content">
        <div class="calendar-header">
          <h2>üìÖ Kalend√°≈ô</h2>
          <button class="close-button" @click="showCalendar = false">√ó</button>
        </div>
        <div class="calendar-body">
          <div class="month-nav">
            <button @click="previousMonth">‚Äπ</button>
            <div class="calendar-month-label">{{ calendarMonthLabel }}</div>
            <button @click="nextMonth">‚Ä∫</button>
          </div>
          <div class="calendar-weekdays">
            <div class="calendar-weekday">Po</div>
            <div class="calendar-weekday">√öt</div>
            <div class="calendar-weekday">St</div>
            <div class="calendar-weekday">ƒåt</div>
            <div class="calendar-weekday">P√°</div>
            <div class="calendar-weekday">So</div>
            <div class="calendar-weekday">Ne</div>
          </div>
          <div class="calendar-grid">
            <div 
              v-for="day in calendarDays" 
              :key="day.key" 
              class="calendar-day" 
              :class="{
                empty: day.empty,
                'other-month': day.otherMonth,
                today: day.isToday,
                'has-completion': day.completionRate > 0 && day.completionRate < 1,
                'full-completion': day.completionRate === 1
              }"
            >
              <span v-if="!day.empty">{{ day.day }}</span>
              <span class="completion-indicator" v-if="day.completionRate > 0 && !day.empty">
                {{ day.completed }}/{{ day.total }}
              </span>
            </div>
          </div>
          <div class="calendar-legend">
            <div class="legend-item">
              <div class="legend-dot today"></div>
              <span>Dnes</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot partial"></div>
              <span>ƒå√°steƒçnƒõ</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot complete"></div>
              <span>Hotovo</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings/Stats View Modal -->
    <div class="settings-view" v-if="showSettings" @click.self="showSettings = false">
      <div class="settings-content">
        <div class="settings-header">
          <h2>üìä Statistiky</h2>
          <button class="close-button" @click="showSettings = false">√ó</button>
        </div>
        <div class="settings-body">
          <!-- Analytics Section -->
          <div class="settings-section">
            <div class="settings-section-title">Anal√Ωza</div>
            
            <!-- Weekly Chart -->
            <div class="analytics-card">
              <h4>T√Ωdenn√≠ p≈ôehled</h4>
              <div class="weekly-chart">
                <div 
                  class="weekly-bar" 
                  v-for="(data, index) in weeklyAnalytics" 
                  :key="index"
                  :class="{ today: data.isToday }"
                >
                  <div class="bar-fill" :style="{ height: data.percentage + '%' }"></div>
                  <span class="bar-label">{{ data.day }}</span>
                  <span class="bar-value">{{ data.percentage }}%</span>
                </div>
              </div>
            </div>

            <!-- Key Metrics -->
            <div class="analytics-metrics">
              <div class="metric-card">
                <span class="metric-icon">üìà</span>
                <div class="metric-info">
                  <span class="metric-value" :class="{ positive: completionTrend > 0, negative: completionTrend < 0 }">
                    {{ completionTrend > 0 ? '+' : '' }}{{ completionTrend }}%
                  </span>
                  <span class="metric-label">Trend ({{ trackingDaysForTrend }} {{ trackingDaysForTrend === 1 ? 'den' : trackingDaysForTrend < 5 ? 'dny' : 'dn√≠' }})</span>
                </div>
              </div>
              <div class="metric-card">
                <span class="metric-icon">‚≠ê</span>
                <div class="metric-info">
                  <span class="metric-value">{{ bestDayOfWeek }}</span>
                  <span class="metric-label">Nejlep≈°√≠ den</span>
                </div>
              </div>
              <div class="metric-card">
                <span class="metric-icon">üìä</span>
                <div class="metric-info">
                  <span class="metric-value">{{ averageCompletionRate }}%</span>
                  <span class="metric-label">Pr≈Ømƒõr ({{ trackingDaysForAverage }} {{ trackingDaysForAverage === 1 ? 'den' : trackingDaysForAverage < 5 ? 'dny' : 'dn√≠' }})</span>
                </div>
              </div>
              <div class="metric-card">
                <span class="metric-icon">üéØ</span>
                <div class="metric-info">
                  <span class="metric-value">{{ perfectDays }}</span>
                  <span class="metric-label">Perfektn√≠ dny</span>
                </div>
              </div>
            </div>

            <!-- Category Breakdown -->
            <div class="analytics-card" v-if="categoryBreakdown.length > 0">
              <h4>Podle kategori√≠</h4>
              <div class="category-breakdown">
                <div 
                  class="category-stat" 
                  v-for="cat in categoryBreakdown" 
                  :key="cat.id"
                >
                  <div class="category-stat-header">
                    <span class="category-stat-dot" :style="{ background: cat.color }"></span>
                    <span class="category-stat-name">{{ cat.name }}</span>
                    <span class="category-stat-value">{{ cat.completionRate }}%</span>
                  </div>
                  <div class="category-stat-bar">
                    <div 
                      class="category-stat-fill" 
                      :style="{ width: cat.completionRate + '%', background: cat.color }"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Overview Section -->
          <div class="settings-section">
            <div class="settings-section-title">P≈ôehled</div>
            <div class="stats-grid">
              <div class="stat-box">
                <div class="stat-box-number">{{ totalHabits }}</div>
                <div class="stat-box-label">Celkem zvyk≈Ø</div>
              </div>
              <div class="stat-box">
                <div class="stat-box-number">{{ todayCompleted }}/{{ todayTotal }}</div>
                <div class="stat-box-label">Dnes splnƒõno</div>
              </div>
              <div class="stat-box">
                <div class="stat-box-number">{{ bestStreak }}</div>
                <div class="stat-box-label">Nejdel≈°√≠ s√©rie</div>
              </div>
              <div class="stat-box">
                <div class="stat-box-number">{{ totalCompletions }}</div>
                <div class="stat-box-label">Celkem splnƒõn√≠</div>
              </div>
            </div>
          </div>

          <!-- Categories Management -->
          <div class="settings-section">
            <div class="settings-section-title">
              Kategorie
              <button class="add-category-btn" @click="showCategoryModal = true">+ P≈ôidat</button>
            </div>
            <div class="settings-item" v-for="category in categories" :key="category.id">
              <div class="settings-item-left">
                <div class="settings-item-icon" :style="{ background: category.color }"></div>
                <div class="settings-item-text">
                  <h4>{{ category.name }}</h4>
                  <p>{{ getCategoryHabitCount(category.id) }} zvyk≈Ø</p>
                </div>
              </div>
              <button class="category-delete-btn" @click="deleteCategory(category.id)">√ó</button>
            </div>
            <div class="settings-item" v-if="categories.length === 0">
              <div class="settings-item-left">
                <div class="settings-item-icon">üè∑Ô∏è</div>
                <div class="settings-item-text">
                  <h4>≈Ω√°dn√© kategorie</h4>
                  <p>P≈ôidej kategorii pro lep≈°√≠ organizaci</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Habits List -->
          <div class="settings-section">
            <div class="settings-section-title">Zvyky</div>
            <div class="settings-item" v-for="habit in habits" :key="habit.id">
              <div class="settings-item-left">
                <div class="settings-item-icon">{{ habit.icon }}</div>
                <div class="settings-item-text">
                  <h4>{{ habit.name }}</h4>
                  <p>{{ habit.dailyGoal }}x dennƒõ ‚Ä¢ {{ getActiveDaysText(habit) }}</p>
                </div>
              </div>
              <div class="settings-value">üî• {{ streak(habit) }}</div>
            </div>
            <div class="settings-item" v-if="habits.length === 0">
              <div class="settings-item-left">
                <div class="settings-item-icon">üìù</div>
                <div class="settings-item-text">
                  <h4>≈Ω√°dn√© zvyky</h4>
                  <p>P≈ôidej sv≈Øj prvn√≠ zvyk</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Habit Modal -->
    <div class="modal" v-if="showModal" @click.self="showModal = false">
      <div class="modal-content">
        <h2>‚ú® Nov√Ω zvyk</h2>
        
        <div class="form-group">
          <label class="form-label">N√°zev</label>
          <input 
            type="text" 
            v-model="newHabit" 
            placeholder="nap≈ô. Cviƒçit, Meditovat..." 
            @keyup.enter="addHabit" 
            ref="habitInput"
          />
        </div>

        <div class="form-group">
          <label class="form-label">Ikonka</label>
          <div class="icon-selector">
            <button 
              v-for="icon in availableIcons" 
              :key="icon" 
              class="icon-option" 
              :class="{ selected: selectedIcon === icon }" 
              @click="selectedIcon = icon"
            >
              {{ icon }}
            </button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Kategorie</label>
          <div class="category-selector">
            <button 
              class="category-option"
              :class="{ selected: selectedCategoryId === null }"
              @click="selectedCategoryId = null"
            >
              ≈Ω√°dn√°
            </button>
            <button 
              v-for="category in categories" 
              :key="category.id"
              class="category-option"
              :class="{ selected: selectedCategoryId === category.id }"
              :style="{ '--cat-color': category.color }"
              @click="selectedCategoryId = category.id"
            >
              <span class="category-option-dot" :style="{ background: category.color }"></span>
              {{ category.name }}
            </button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Denn√≠ c√≠l</label>
          <div class="frequency-selector">
            <button class="frequency-btn" :class="{ active: dailyGoal === 1 }" @click="dailyGoal = 1">1√ó</button>
            <button class="frequency-btn" :class="{ active: dailyGoal === 2 }" @click="dailyGoal = 2">2√ó</button>
            <button class="frequency-btn" :class="{ active: dailyGoal === 3 }" @click="dailyGoal = 3">3√ó</button>
          </div>
          <div class="custom-frequency" v-if="dailyGoal > 3 || showCustom">
            <input type="number" v-model.number="customGoal" min="1" max="20" @input="dailyGoal = customGoal" />
            <span>√ó dennƒõ</span>
          </div>
          <button 
            v-if="dailyGoal <= 3 && !showCustom" 
            class="frequency-btn" 
            style="margin-top: 10px; width: 100%;" 
            @click="showCustom = true; customGoal = 4; dailyGoal = 4"
          >
            Vlastn√≠
          </button>
        </div>

        <div class="form-group">
          <label class="form-label">Aktivn√≠ dny</label>
          <div class="day-selector">
            <button 
              v-for="(dayName, index) in dayNames" 
              :key="index" 
              class="day-btn" 
              :class="{ active: selectedDays.includes(index) }" 
              @click="toggleDay(index)"
            >
              {{ dayName }}
            </button>
          </div>
        </div>

        <div class="modal-buttons">
          <button class="btn-cancel" @click="closeModal">Zav≈ô√≠t</button>
          <button class="btn-primary" @click="addHabit">Vytvo≈ôit</button>
        </div>
      </div>
    </div>

    <!-- Add Category Modal -->
    <div class="modal" v-if="showCategoryModal" @click.self="showCategoryModal = false">
      <div class="modal-content modal-small">
        <h2>üè∑Ô∏è Nov√° kategorie</h2>
        
        <div class="form-group">
          <label class="form-label">N√°zev</label>
          <input 
            type="text" 
            v-model="newCategoryName" 
            placeholder="nap≈ô. Zdrav√≠, Pr√°ce..." 
            @keyup.enter="addCategory"
          />
        </div>

        <div class="form-group">
          <label class="form-label">Barva</label>
          <div class="color-selector">
            <button 
              v-for="color in availableColors" 
              :key="color"
              class="color-option"
              :class="{ selected: selectedColor === color }"
              :style="{ background: color }"
              @click="selectedColor = color"
            ></button>
          </div>
        </div>

        <div class="modal-buttons">
          <button class="btn-cancel" @click="showCategoryModal = false">Zav≈ô√≠t</button>
          <button class="btn-primary" @click="addCategory">Vytvo≈ôit</button>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="delete-modal" v-if="habitToDelete" @click.self="habitToDelete = null">
      <div class="delete-modal-content">
        <div class="delete-modal-icon">üóëÔ∏è</div>
        <h3>Smazat zvyk?</h3>
        <p>Tato akce je nevratn√°. V≈°echna data o tomto zvyku budou ztracena.</p>
        <div class="delete-modal-habit">
          <span class="delete-modal-habit-icon">{{ habitToDelete.icon }}</span>
          <span class="delete-modal-habit-name">{{ habitToDelete.name }}</span>
        </div>
        <div class="delete-modal-buttons">
          <button class="btn-delete-cancel" @click="habitToDelete = null">Zru≈°it</button>
          <button class="btn-delete-confirm" @click="confirmDelete">Smazat</button>
        </div>
      </div>
    </div>

    <!-- Edit Habit Modal -->
    <div class="modal" v-if="habitToEdit" @click.self="habitToEdit = null">
      <div class="modal-content">
        <h2>‚úèÔ∏è Upravit zvyk</h2>
        
        <div class="form-group">
          <label class="form-label">N√°zev</label>
          <input 
            type="text" 
            v-model="editForm.name" 
            placeholder="nap≈ô. Cviƒçit, Meditovat..."
          />
        </div>

        <div class="form-group">
          <label class="form-label">Ikonka</label>
          <div class="icon-selector">
            <button 
              v-for="icon in availableIcons" 
              :key="icon" 
              class="icon-option" 
              :class="{ selected: editForm.icon === icon }" 
              @click="editForm.icon = icon"
            >
              {{ icon }}
            </button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Kategorie</label>
          <div class="category-selector">
            <button 
              class="category-option"
              :class="{ selected: editForm.categoryId === null }"
              @click="editForm.categoryId = null"
            >
              ≈Ω√°dn√°
            </button>
            <button 
              v-for="category in categories" 
              :key="category.id"
              class="category-option"
              :class="{ selected: editForm.categoryId === category.id }"
              :style="{ '--cat-color': category.color }"
              @click="editForm.categoryId = category.id"
            >
              <span class="category-option-dot" :style="{ background: category.color }"></span>
              {{ category.name }}
            </button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Denn√≠ c√≠l</label>
          <div class="frequency-selector">
            <button class="frequency-btn" :class="{ active: editForm.dailyGoal === 1 }" @click="editForm.dailyGoal = 1">1√ó</button>
            <button class="frequency-btn" :class="{ active: editForm.dailyGoal === 2 }" @click="editForm.dailyGoal = 2">2√ó</button>
            <button class="frequency-btn" :class="{ active: editForm.dailyGoal === 3 }" @click="editForm.dailyGoal = 3">3√ó</button>
          </div>
          <div class="custom-frequency" v-if="editForm.dailyGoal > 3 || editShowCustom">
            <input type="number" v-model.number="editForm.dailyGoal" min="1" max="20" />
            <span>√ó dennƒõ</span>
          </div>
          <button 
            v-if="editForm.dailyGoal <= 3 && !editShowCustom" 
            class="frequency-btn" 
            style="margin-top: 10px; width: 100%;" 
            @click="editShowCustom = true; editForm.dailyGoal = 4"
          >
            Vlastn√≠
          </button>
        </div>

        <div class="form-group">
          <label class="form-label">Aktivn√≠ dny</label>
          <div class="day-selector">
            <button 
              v-for="(dayName, index) in dayNames" 
              :key="index" 
              class="day-btn" 
              :class="{ active: editForm.activeDays.includes(index) }" 
              @click="toggleEditDay(index)"
            >
              {{ dayName }}
            </button>
          </div>
        </div>

        <div class="modal-buttons">
          <button class="btn-cancel" @click="habitToEdit = null">Zru≈°it</button>
          <button class="btn-primary" @click="saveHabitEdit">Ulo≈æit</button>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>